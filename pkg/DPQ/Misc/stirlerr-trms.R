### <---> ../R/dgamma.R  stirlerr() definition
###       ~~~~~~~~~~~~~  ==========

## From Maple asympt(ln(GAMMA(x+1)), x, 23);
##>> ~/maple/gamma-asympt.mw
##>> ~/maple/gamma-asympt-3.tex <<

## (ln(x)-1)*x+(1/2)*ln(x)+(1/2)*ln(2*Pi)+(1/12)/x-(1/360)/x^3+(1/1260)/x^5 -
##  (1/1680)/x^7+(1/1188)/x^9-(691/360360)/x^11+(1/156)/x^13-(3617/122400)/x^15 +
## (43867/244188)/x^17-(174611/125400)/x^19+(77683/5796)/x^21 + O(1/x^23)}

require(gmp)

Sq <- c(
as.bigq(1,  12),	## 1/12
as.bigq(1,  360),	## 1/360
as.bigq(1, 1260),	## 1/1260
as.bigq(1, 1680),	## 1/1680
as.bigq(1, 1188),	## 1/1188
as.bigq(691, 360360),	## 691/360360
as.bigq(1, 156),	## 1/156
as.bigq(3617, 122400),	## 3617/122400
as.bigq(43867, 244188), ## 43867/244188
as.bigq(174611, 125400),## 174611/125400
as.bigq(77683, 5796),	## 77683/5796
NULL)

require(Rmpfr)
cbind(mpfr(Sq, 80))
## 'mpfrMatrix' of dim(.) =  (11, 1) of precision  80   bits
##  [1,]   0.083333333333333333333333368
##  [2,]  0.0027777777777777777777777776
##  [3,] 0.00079365079365079365079365075
##  [4,] 0.00059523809523809523809523806
##  [5,] 0.00084175084175084175084175104
##  [6,]  0.0019175269175269175269175262
##  [7,]  0.0064102564102564102564102561
##  [8,]   0.029550653594771241830065352
##  [9,]    0.17964437236883057316493850
## [10,]     1.3924322169059011164274315
## [11,]     13.402864044168391994478957


S0 <-    0.083333333333333333333333368
S1 <-   0.0027777777777777777777777776
S2 <-  0.00079365079365079365079365075 ## 1/1260
S3 <-  0.00059523809523809523809523806 ## 1/1680
S4 <-  0.00084175084175084175084175104 ## 1/1188
S5 <-   0.0019175269175269175269175262 ## 691/360360
S6 <-   0.0064102564102564102564102561 ## 1/156
S7 <-    0.029550653594771241830065352 ## 3617/122400
S8 <-     0.17964437236883057316493850 ## 43867/244188
S9 <-      1.3924322169059011164274315 ## 174611/125400
S10<-      13.402864044168391994478957 ## 77683/5796


##====================================================================
## stirlerr(z)  around  z=0 :
# In Wolfram Alpha  :
'
Series[LogGamma[z+1] - (z+1/2)*Log[z] + z - Log[2 Pi]/2, {z, 0, 9}]
'
## ==>
https://www.wolframalpha.com/input?i=Series%5BLogGamma%5Bz%2B1%5D+-+%28z%2B1%2F2%29*Log%5Bz%5D+%2B+z+-+Log%5B2+Pi%5D%2F2%2C+%7Bz%2C+0%2C+9%7D%5D
"https://www.wolframalpha.com/input?i=Series%5BLogGamma%5Bz%2B1%5D+-+%28z%2B1%2F2%29*Log%5Bz%5D+%2B+z+-+Log%5B2+Pi%5D%2F2%2C+%7Bz%2C+0%2C+5%7D%9D"

## output, copyable text:
-1/2 log(2 π z) + z (-log(z) - gamma + 1) + (π^2 z^2)/12 + (z^3 polygamma(2, 1))/6 + (π^4 z^4)/360 + (z^5 polygamma(4, 1))/120 + (π^6 z^6)/5670 + (z^7 polygamma(6, 1))/5040 + (π^8 z^8)/75600 + (z^9 polygamma(8, 1))/362880 + O(z^10)
## (generalized Puiseux series)

## MM: R code
-1/2 log(2 π z) + z (-log(z) - gamma + 1) + (π^2 z^2)/12 + (z^3 psigamma(1, 2))/6 + (π^4 z^4)/360 + (z^5 psigamma(1, 4))/120 + (π^6 z^6)/5670 + (z^7 psigamma(1, 6))/5040 + (π^8 z^8)/75600 + (z^9 psigamma(1, 8))/362880 ## + O(z^10)
## (generalized Puiseux series)

## output, "Wolfram Language" (Mathematica)  text:
-Log[2 Pi z]/2 + (1 - EulerGamma - Log[z]) z + (Pi^2 z^2)/12 + (z^3 PolyGamma[2, 1])/6 + (Pi^4 z^4)/360 + (z^5 PolyGamma[4, 1])/120 + (Pi^6 z^6)/5670 + (z^7 PolyGamma[6, 1])/5040 + (Pi^8 z^8)/75600 + (z^9 PolyGamma[8, 1])/362880 + O[z]^10

setwd('/scratch/users/maechler/R/D/R-forge/specfun/pkg/DPQ/Misc/')
system("eog stirlerr_z=0_series_alpha.png &")

##--- the same, series around z = 5: ---------------------------------------
##                            ~~~~~~
'
Series[LogGamma[z+1] - (z+1/2)*Log[z] + z - Log[2 Pi]/2, {z, 5, 9}]
'
system("eog stirlerr_z=5_series_alpha.png &")

## output, copyable text:
(5 - (11 log(5))/2 + log(120) - 1/2 log(2 π)) + (z - 5) (131/60 - gamma - log(5)) + (π^2/12 - 5917/7200) (z - 5)^2 + (z - 5)^3 (2/375 + polygamma(2, 6)/6) + (π^4/360 - 14025553/51840000) (z - 5)^4 + (z - 5)^5 (3/62500 + polygamma(4, 6)/120) + (π^6/5670 - 47464869601/279936000000) (z - 5)^6 + (z - 5)^7 (1/1640625 + polygamma(6, 6)/5040) + (π^8/75600 - 1180524695078791/9405849600000000) (z - 5)^8 + (z - 5)^9 (1/140625000 + polygamma(8, 6)/362880) + O((z - 5)^10)
## (Taylor series)

## output, "Wolfram Language" (Mathematica)  text:
(5 - (11 Log[5])/2 + Log[120] - Log[2 Pi]/2) + (131/60 - EulerGamma - Log[5]) (-5 + z) + (-5917/7200 + Pi^2/12) (-5 + z)^2 + (2/375 + PolyGamma[2, 6]/6) (-5 + z)^3 + (-14025553/51840000 + Pi^4/360) (-5 + z)^4 + (3/62500 + PolyGamma[4, 6]/120) (-5 + z)^5 + (-47464869601/279936000000 + Pi^6/5670) (-5 + z)^6 + (1/1640625 + PolyGamma[6, 6]/5040) (-5 + z)^7 + (-1180524695078791/9405849600000000 + Pi^8/75600) (-5 + z)^8 + (1/140625000 + PolyGamma[8, 6]/362880) (-5 + z)^9 + O[-5 + z]^10

## MM: R-code s/ polygamma(k,z) / psigamma(z, k) /
(5 - (11 log(5))/2 + log(120) - 1/2 log(2 π)) + (z - 5) (131/60 - gamma - log(5)) + (π^2/12 - 5917/7200) (z - 5)^2 + (z - 5)^3 (2/375 + psigamma(6, 2)/6) + (π^4/360 - 14025553/51840000) (z - 5)^4 + (z - 5)^5 (3/62500 + psigamma(6, 4)/120) + (π^6/5670 - 47464869601/279936000000) (z - 5)^6 + (z - 5)^7 (1/1640625 + psigamma(6, 6)/5040) + (π^8/75600 - 1180524695078791/9405849600000000) (z - 5)^8 + (z - 5)^9 (1/140625000 + psigamma(6, 8)/362880) ##+ O((z - 5)^10)

require(Rmpfr)

## in all cases,  psigamm(2k, z+1) = rational  - (2k)! zeta(2k+1)
kk0 <- 4L
str(twok1 <- 2L*(1:kk0) + 1L) # 2k + 1
twok1 <- mpfr(twok1, 128)
##        - (2k)!          zeta(2k+1)
F2zeta <- - gamma(twok1) * zeta(twok1)
## \psi^{(2k)}(1) =
(psigam_1 <- F2zeta)
## [1] -2.404113806319188570799476323022899981535 -24.88626612344087823195277167496882003344
## [3] -726.0114797149844353246542358918536669099  -40400.9783987476348853278236554508542788

## psigam_1 <- -(twok1-1)! zeta(twok1)
(psigam_1 <- - gamma(twok1) * zeta(twok1))

## output, copyable text:
(4 - 9 log(2) + log(24) - 1/2 log(2 π)) + (z - 4) (47/24 - gamma - log(4)) + 1/576 (48 π^2 - 473) (z - 4)^2 + (z - 4)^3 (1/128 + polygamma(2, 5)/6) + (π^4/360 - 44873/165888) (z - 4)^4 + ((z - 4)^5 (3 + 256 polygamma(4, 5)))/30720 + (π^6/5670 - 30376837/179159040) (z - 4)^6 + (z - 4)^7 (1/688128 + polygamma(6, 5)/5040) + (π^8/75600 - 6044274287/48157949952) (z - 4)^8 + ((z - 4)^9 polygamma(8, 5))/362880 + O((z - 4)^10)
##(Taylor series)
## MM: R-code s/ polygamma(k,z) / psigamma(z, k) /
(4 - 9 log(2) + log(24) - 1/2 log(2 π)) + (z - 4) (47/24 - gamma - log(4)) + 1/576 (48 π^2 - 473) (z - 4)^2 + (z - 4)^3 (1/128 + psigamma(5, 2)/6) + (π^4/360 - 44873/165888) (z - 4)^4 + ((z - 4)^5 (3 + 256 psigamma(5, 4)))/30720 + (π^6/5670 - 30376837/179159040) (z - 4)^6 + (z - 4)^7 (1/688128 + psigamma(5, 6)/5040) + (π^8/75600 - 6044274287/48157949952) (z - 4)^8 + ((z - 4)^9 psigamma(5, 8))/362880 ## + O((z - 4)^10)


## z = 4
## ===== --------------------------------
'                                                            #
Series[LogGamma[z+1] - (z+1/2)*Log[z] + z - Log[2 Pi]/2, {z, 4, 9}]
'
system("eog stirlerr_z=4_series_alpha.png &")
## output, copyable text:
(4 - 9 log(2) + log(24) - 1/2 log(2 π)) + (z - 4) (47/24 - gamma - log(4)) + 1/576 (48 π^2 - 473) (z - 4)^2 + (z - 4)^3 (1/128 + polygamma(2, 5)/6) + (π^4/360 - 44873/165888) (z - 4)^4 + ((z - 4)^5 (3 + 256 polygamma(4, 5)))/30720 + (π^6/5670 - 30376837/179159040) (z - 4)^6 + (z - 4)^7 (1/688128 + polygamma(6, 5)/5040) + (π^8/75600 - 6044274287/48157949952) (z - 4)^8 + ((z - 4)^9 polygamma(8, 5))/362880 + O((z - 4)^10)
## (Taylor series)
## MM: R-code s/ polygamma(k,z) / psigamma(z, k) /
(4 - 9 log(2) + log(24) - 1/2 log(2 π)) + (z - 4) (47/24 - gamma - log(4)) + 1/576 (48 π^2 - 473) (z - 4)^2 + (z - 4)^3 (1/128 + psigamma(5, 2)/6) + (π^4/360 - 44873/165888) (z - 4)^4 + ((z - 4)^5 (3 + 256 psigamma(5, 4)))/30720 + (π^6/5670 - 30376837/179159040) (z - 4)^6 + (z - 4)^7 (1/688128 + psigamma(5, 6)/5040) + (π^8/75600 - 6044274287/48157949952) (z - 4)^8 + ((z - 4)^9 psigamma(5, 8))/362880 ## + O((z - 4)^10)


## z = 4  ==> evaluate psigamma^(2k)(z+1) = psigamma(z+1, 2*k)
## ===== --------------------------------
## Polygamma(2,5)
##    FunctionExpand[PolyGamma[2, 5]]
'2 (2035/1728 - ζ(3))'
psigamma(5, deriv=2) # -0.04878973

## Polygamma(4,5)
##    FunctionExpand[PolyGamma[4, 5]]
'24 (257875/248832 - ζ(5))'
psigamma(5, deriv=4) # -0.01406319

## Polygamma(6,5)
##    FunctionExpand[PolyGamma[6, 5]]
'720 (36130315/35831808 - ζ(7))' # -0.013316295488550550991684451524448804905878833309317180114640224
psigamma(5, deriv=6) # -0.0133163

## Polygamma(8,5)
##    FunctionExpand[PolyGamma[8, 5]]
'40320 (5170139875/5159780352 - ζ(9))' #-0.026121932577157847256668711028032780542422983569899521811529705...
psigamma(5, deriv=8) #  -0.02612193

##----------------- R code -------------------------
Const("gamma", 128) #  'mpfr' number ..  128 bits -- 0.5772156649015328606065120900824024310432
Const("pi",    128)

## no Rmpfr here, for now:
gamma <- 0.5772156649015328606065120900824024310432
π     <- 3.141592653589793238462643383279502884195
## z = 0:
f0 <- function(z)
-1/2*log(2*π*z) + z*(-log(z) - gamma + 1) + (π^2 * z^2)/12 + (z^3* psigamma(1, 2))/6 + (π^4 * z^4)/360 + (z^5* psigamma(1, 4))/120 + (π^6 * z^6)/5670 + (z^7* psigamma(1, 6))/5040 + (π^8 * z^8)/75600 + (z^9* psigamma(1, 8))/362880 ## + O(z^10)

## z = 4:
f4 <- function(z)
(4 - 9*log(2) + log(24) - 1/2*log(2*π)) + (z - 4) * (47/24 - gamma - log(4)) + 1/576*(48*π^2 - 473) * (z - 4)^2 + (z - 4)^3*(1/128 + psigamma(5, 2)/6) + (π^4/360 - 44873/165888) * (z - 4)^4 + ((z - 4)^5*(3 + 256* psigamma(5, 4)))/30720 + (π^6/5670 - 30376837/179159040) * (z - 4)^6 + (z - 4)^7*(1/688128 + psigamma(5, 6)/5040) + (π^8/75600 - 6044274287/48157949952) * (z - 4)^8 + ((z - 4)^9* psigamma(5, 8))/362880 ## + O((z - 4)^10)

## z = 5:
f5 <- function(z)
(5 - (11*log(5))/2 + log(120) - 1/2*log(2*π)) + (z - 5) * (131/60 - gamma - log(5)) + (π^2/12 - 5917/7200) * (z - 5)^2 + (z - 5)^3*(2/375 + psigamma(6, 2)/6) + (π^4/360 - 14025553/51840000) * (z - 5)^4 + (z - 5)^5*(3/62500 + psigamma(6, 4)/120) + (π^6/5670 - 47464869601/279936000000) * (z - 5)^6 + (z - 5)^7*(1/1640625 + psigamma(6, 6)/5040) + (π^8/75600 - 1180524695078791/9405849600000000) * (z - 5)^8 + (z - 5)^9*(1/140625000 + psigamma(6, 8)/362880) ##+ O((z - 5)^10)

## try them

## 1.  z = 0 :
f0xy <- curve(f0, 0, 1.5, n = 1001)
lines(stirlerr(x) ~ x, data=f0xy,  lwd = 3, col = adjustcolor(2, 1/2))
                                        # looks good ... but how large is the error
## even only in [0, 1/4]
x <- seq(0, 0.25, by = 2^-10)
xM <- mpfr(x, 256)
plot(x, abs(asNumeric(f0(x) / stirlerrM(xM) -1)), type = "l", lwd=2, log="y")

## 2.  z = 4 :
f4xy <- curve(f4, 3, 5, n = 1001)
lines(stirlerr(x) ~ x, data=f4xy,  lwd = 3, col = adjustcolor(2, 1/2))
                                        # looks good ... but how large is the error :
##
x <- seq(3.5, 4.5, by = 2^-10)
xM <- mpfr(x, 256)
plot(x, abs(asNumeric(f4(x) / stirlerrM(xM) -1)), type = "l", lwd=2, log="y")
